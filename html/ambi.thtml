<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8"/>
      <title>Ambi</title>
   </head>
   <body>

      <input id="search_input" type="text" value="">
      <input id="search_button" type="button" value="Watch" onclick="button_clicked();">

      <div id="search_results_list"></div>

      <div id="player"></div>

      <div id="playlist">@_PLAYLIST_@</div>


      <script>
         function button_clicked() {
         var xhttp = new XMLHttpRequest();
         xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
               document.getElementById("search_results_list").innerHTML = xhttp.responseText;
            }
         };

         xhttp.open("GET", "onclick$search_button?search_input=" + document.getElementById("search_input").value, true);
         xhttp.send();
         }
      </script>

      <script>
         function select_result_item(elm) {
			document.getElementById("search_input").value = "";
			document.getElementById("search_results_list").innerHTML = "";

            var x = elm.getAttribute('value');
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
               if (this.readyState == 4 && this.status == 200) {
                  document.getElementById("playlist").innerHTML = xhttp.responseText;
               }
            };

            xhttp.open("GET", "onclick$search_result_item_" + String(x), true);
            xhttp.send();
         }

         const sleep = (milliseconds) => {
            return new Promise(resolve => setTimeout(resolve, milliseconds))
         }

         function reload_page() {
            sleep(10).then(() => {
               location.reload();
            })
         }

         // Youtube player script
         var tag = document.createElement('script');

         tag.src = "https://www.youtube.com/iframe_api";
         var firstScriptTag = document.getElementsByTagName('script')[0];
         firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

         var player;
         function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
               height: '360',
               width: '640',
               videoId: '@_VIDEO_ID_@',
               playerVars: { controls:1, showinfo: 0, rel: 0, showsearch: 0, iv_load_policy: 3, modestbranding: 1, enablejsapi: 1 },
               events: {
                 'onReady': onPlayerReady,
                 'onStateChange': onPlayerStateChange
               }
            });
         }

         function onPlayerReady(event) {
            event.target.playVideo();
         }

         function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.ENDED) {
               player.stopVideo();
            }
         }
      </script>
   </body>
</html>
