<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8"/>
      <title>Ambi</title>
      @@INCLUDE@@ ../javascripts/aws.tjs
   </head>
   <body>

      <input id="search_input" type="text" value="">
      <input id="search_button" type="button" value="Watch">

      <div id="search_results_list"></div>

      @@INCLUDE@@ ../javascripts/aws_action_replace.tjs (onclick, search_button, search_results_list, 5=>search_input)

      <script>
         function select_result_item(elm) {
            @@INCLUDE@@ ../javascripts/aws_func_clear.tjs (search_input)

            var x = elm.getAttribute('value');
            var rurl = "/onclick$search_result_item_" + String(x);
            var rpars = "";
            var roncomplete = reload_page();
            AWS.Ajax.replace (rurl, rpars, 'search_results_list', roncomplete);
         }

         const sleep = (milliseconds) => {
            return new Promise(resolve => setTimeout(resolve, milliseconds))
         }

         function reload_page() {
            sleep(10).then(() => {
               location.reload();
            })
         }
      </script>

      <div id="player"></div>

      <script>
         // 2. This code loads the IFrame Player API code asynchronously.
         var tag = document.createElement('script');
         
         tag.src = "https://www.youtube.com/iframe_api";
         var firstScriptTag = document.getElementsByTagName('script')[0];
         firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
         
         // 3. This function creates an <iframe> (and YouTube player)
         //    after the API code downloads.
         var player;
         function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
               height: '360',
               width: '640',
               videoId: '@_VIDEO_ID_@',
               events: {
                 'onReady': onPlayerReady,
                 'onStateChange': onPlayerStateChange
               }
            });
         }
         
         // 4. The API will call this function when the video player is ready.
         function onPlayerReady(event) {
            event.target.playVideo();
         }
         
         // 5. The API calls this function when the player's state changes.
         //    The function indicates that when playing a video (state=1),
         //    the player should play for six seconds and then stop.
         var done = false;
         function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.ENDED) {
				stopVideo();
            }
         }
         function stopVideo() {
            player.stopVideo();
         }
      </script>
   </body>
</html>
